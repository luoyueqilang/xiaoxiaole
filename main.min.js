var __reflect=this&&this.__reflect||function(e,t,o){e.__class__=t,o?o.push(t):o=[t],e.__types__=e.__types__?o.concat(e.__types__):o},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))(function(a,c){function r(e){try{n(i.next(e))}catch(t){c(t)}}function l(e){try{n(i["throw"](e))}catch(t){c(t)}}function n(e){e.done?a(e.value):new o(function(t){t(e.value)}).then(r,l)}n((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function o(e){return function(t){return i([e,t])}}function i(o){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,c&&(r=c[2&o[0]?"return":o[0]?"throw":"next"])&&!(r=r.call(c,o[1])).done)return r;switch(c=0,r&&(o=[0,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,c=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(r=n.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){n=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){n.label=o[1];break}if(6===o[0]&&n.label<r[1]){n.label=r[1],r=o;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(o);break}r[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(i){o=[6,i],c=0}finally{a=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var a,c,r,l,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},happyClear;!function(e){var t="hc_animal_%d_png",o=function(e){function o(t,o,i){var a=e.call(this)||this;return a.downStatus=0,a.position={x:null,y:null},1==i?(a.position.x=145+50*o,a.position.y=825-50*t):0==i?(a.position.x=145+50*o,a.position.y=225,a.visible=!1):(a.position.x=t,a.position.y=o),a._status=i,a.row=t,a.column=o,a.order=10*o+t,a.touchChildren=!1,a.touchEnabled=!0,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.initBlock,a),a}return __extends(o,e),Object.defineProperty(o.prototype,"Value",{get:function(){return this._value},set:function(e){this._value=e,this.displayByValue(e)},enumerable:!0,configurable:!0}),o.prototype.initBlock=function(){this.lockImg=new egret.Bitmap,this._block=new egret.Bitmap,this.lineClearIce=new egret.Bitmap,this.lockImg.texture=RES.getRes("hc_ice_png"),this.lineClearIce.texture=RES.getRes("hc_lock_png"),this.width=50,this.height=50,this.x=this.position.x,this.y=this.position.y,this.addChild(this._block),this.addChild(this.lineClearIce),this.addChild(this.lockImg),this.lineClearIce.alpha=.7,this.lineClearIce.visible=!1,this.lineClearIce.width=48,this.lineClearIce.height=48,this.lockImg.alpha=1,this.lockImg.visible=!1,this.lockImg.width=48,this.lockImg.height=48,this.lineClearIce.x=1,this.lineClearIce.y=1,this.lockImg.x=1,this.lockImg.y=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this._block.x=1,this._block.y=1,3==this._status?(this._block.width=32,this._block.height=32,this.lockImg.width=32,this.lockImg.height=32):(this._block.width=48,this._block.height=48)},o.prototype.displayByValue=function(e){this._block.texture=RES.getRes(t.replace("%d",e))},o}(egret.DisplayObjectContainer);e.BlockView=o,__reflect(o.prototype,"happyClear.BlockView")}(happyClear||(happyClear={}));var happyClear;!function(e){var t=function(t){function o(){var e=t.call(this)||this;return e.saveColorVec=[],e.saveLockVec=[],e.lockVec=[],e.stepCount=0,e.saveStepCount=[],e.gameScore=0,e.saveGameScore=[],e.firstFlag=!0,e.clearLength=0,e.clearCount=0,e.saveClearCount=[],e.touchStatus=1,e.backCount=0,e._selectBlock=[null,null],e.touchEnabled=!0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(o,t),o.prototype.init=function(){this.uiView=new e.UIView(this),this.addChild(this.uiView);var t=new e.DrawTable;this.addChild(t),this.animalContainer=new egret.DisplayObjectContainer,this.lockContainer=new egret.DisplayObjectContainer,this.addChild(this.animalContainer),this.addChild(this.lockContainer),this.gameData=new e.GameData(this),this.addChild(this.gameData),this.gameLogic=new e.GameLogic(this),this.downLogic=new e.DownLogic(this),this.addChild(this.gameLogic),this.addWatch()},o.prototype.addWatch=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},o.prototype.onStart=function(t){this.colorVec=t,this.blockMap=[],this.lockMap=[];var o=e.deepCopy(e.LOCK_CONF[main_round]);this.lockVec=o,this.saveLockVec.push(o);for(var i=0;10>i;i++){this.blockMap[i]=[],this.lockMap[i]=[];for(var a=0;12>a;a++)if(e.Block_Conf[main_round][i][a]>0){var c=new e.BlockView(a,i,1);this.blockMap[i].push(c),this.lockMap[i].push(null),this.animalContainer.addChild(c),c.Value=t[i][a]}else if(0==e.Block_Conf[main_round][i][a]){var c=new e.BlockView(a,i,1);this.animalContainer.addChild(c),c.Value=t[i][a],this.blockMap[i].push(c),this.lockMap[i].push(null)}else this.blockMap[i].push(null),this.lockMap[i].push(null)}if(this.saveColorVec.push(e.deepCopy(this.colorVec)),this.uiView.score.text=""+this.gameScore,this.uiView.roundInfo.text=""+main_round,0==e.OVER_CONF[main_round])this.clearColor=0,this.stepCount=e.STEP_SCORE[main_round][0],this.uiView.target_score.visible=!0,this.uiView.colorCount.text=""+e.STEP_SCORE[main_round][1];else if(1==e.OVER_CONF[main_round])this.clearColor=Math.ceil(6*Math.random()),this.animalInfo=new e.BlockView(500,160,3),this.animalContainer.addChild(this.animalInfo),this.animalInfo.Value=this.clearColor,this.stepCount=e.STEP_SCORE[main_round][0],this.clearCount=e.COLOR_NUM[main_round],this.uiView.target_score.visible=!1,this.uiView.colorCount.text="剩"+this.clearCount;else{this.clearColor=0,this.stepCount=e.STEP_SCORE[main_round][0],this.uiView.target_score.visible=!1,this.animalInfo=new e.BlockView(500,160,3),this.animalContainer.addChild(this.animalInfo),this.animalInfo.lockImg.visible=!0;for(var i=0;10>i;i++)for(var a=0;12>a;a++)if(1==e.LOCK_CONF[main_round][i][a]){var c=new e.BlockView(a,i,1);c.touchEnabled=!1,c.touchChildren=!1,this.lockContainer.addChild(c),this.lockMap[i][a]=c,c.lockImg.visible=!0,c.alpha=.9,this.clearCount++}else this.lockMap[i][a]=null;this.uiView.colorCount.text="剩"+this.clearCount}this.uiView.stepCount.text=""+this.stepCount,this.saveClearCount.push(this.clearCount),this.saveStepCount.push(this.stepCount),this.saveGameScore.push(this.gameScore)},o.prototype.onTouchBegin=function(t){this._selectBlock=[null,null],e.bBlock(t.target)&&t.target.Value&&(this._selectBlock[0]=t.target)},o.prototype.onTouchEnd=function(t){var o=this;if(1==this.touchStatus)if(e.bBlock(t.target)&&null!=this._selectBlock[0]){if(t.target.Value){var i=e.bBlock(t.target);if(!(i.row!=this._selectBlock[0].row&&i.column!=this._selectBlock[0].column||1!=Math.abs(i.row-this._selectBlock[0].row)&&1!=Math.abs(i.column-this._selectBlock[0].column)))if(this._selectBlock[1]=i,i.column==this._selectBlock[0].column){var a=this._selectBlock[0].row,c=i.row;egret.Tween.get(this._selectBlock[0]).to({y:825-50*c},100),egret.Tween.get(this._selectBlock[1]).to({y:825-50*a},100),this._selectBlock[0].row=c,this._selectBlock[1].row=a,this._selectBlock[0].order=10*this._selectBlock[0].column+this._selectBlock[0].row,this._selectBlock[1].order=10*this._selectBlock[1].column+this._selectBlock[1].row,this.colorVec[i.column][a]=this._selectBlock[1].Value,this.colorVec[i.column][c]=this._selectBlock[0].Value;var r=this.gameLogic.canClear(a,i.column),l=this.gameLogic.canClear(c,i.column);if(0==r&&0==l)setTimeout(function(){o._selectBlock[0].row=a,o._selectBlock[1].row=c,o._selectBlock[0].order=10*o._selectBlock[0].column+o._selectBlock[0].row,o._selectBlock[1].order=10*o._selectBlock[1].column+o._selectBlock[1].row,o.colorVec[i.column][a]=o._selectBlock[0].Value,o.colorVec[i.column][c]=o._selectBlock[1].Value,egret.Tween.get(o._selectBlock[0]).to({y:825-50*a},100),egret.Tween.get(o._selectBlock[1]).to({y:825-50*c},100)},100);else{this.blockMap[i.column][a]=this._selectBlock[1],this.blockMap[i.column][c]=this._selectBlock[0];var n=this.gameLogic.getClearList(r,a,i.column),s=this.gameLogic.getClearList(l,c,i.column),h=[];if(1==this._selectBlock[0].lineClearIce.visible&&l)for(var u=0;12>u;u++)this.colorVec[i.column][u]&&h.push(this.blockMap[i.column][u]);if(1==this._selectBlock[1].lineClearIce.visible&&r)for(var u=0;12>u;u++)this.colorVec[i.column][u]&&h.push(this.blockMap[i.column][u]);for(var g=[],_=n.concat(s).concat(h),u=0;u<_.length;u++)-1==g.indexOf(_[u])&&_[u]instanceof e.BlockView&&g.push(_[u]);if(0==e.DOWN_ROUND[main_round]&&g.sort(function(e,t){return e.order-t.order}),g.length){this.stepCount--;for(var m=g.length-1;m>=0;m--)this.clearLength++,this.clearAnimation(g[m],m)}}}else{var V=this._selectBlock[0].column,p=i.column;egret.Tween.get(this._selectBlock[0]).to({x:50*p+145},100),egret.Tween.get(this._selectBlock[1]).to({x:50*V+145},100),this._selectBlock[0].column=p,this._selectBlock[1].column=V,this._selectBlock[0].order=10*this._selectBlock[0].column+this._selectBlock[0].row,this._selectBlock[1].order=10*this._selectBlock[1].column+this._selectBlock[1].row,this.colorVec[V][i.row]=this._selectBlock[1].Value,this.colorVec[p][i.row]=this._selectBlock[0].Value;var r=this.gameLogic.canClear(i.row,V),l=this.gameLogic.canClear(i.row,p);if(0==r&&0==l)setTimeout(function(){o._selectBlock[0].column=V,o._selectBlock[1].column=p,o._selectBlock[0].order=10*o._selectBlock[0].column+o._selectBlock[0].row,o._selectBlock[1].order=10*o._selectBlock[1].column+o._selectBlock[1].row,o.colorVec[V][i.row]=o._selectBlock[0].Value,o.colorVec[p][i.row]=o._selectBlock[1].Value,egret.Tween.get(o._selectBlock[0]).to({x:50*V+145},100),egret.Tween.get(o._selectBlock[1]).to({x:50*p+145},100)},101);else{this.blockMap[V][i.row]=this._selectBlock[1],this.blockMap[p][i.row]=this._selectBlock[0];var n=this.gameLogic.getClearList(r,i.row,V),s=this.gameLogic.getClearList(l,i.row,p),w=[];if(1==this._selectBlock[0].lineClearIce.visible&&l)for(var u=0;10>u;u++)this.colorVec[u][i.row]&&w.push(this.blockMap[u][i.row]);if(1==this._selectBlock[1].lineClearIce.visible&&r)for(var u=0;10>u;u++)this.colorVec[u][i.row]&&w.push(this.blockMap[u][i.row]);for(var g=[],_=n.concat(s).concat(w),u=0;u<_.length;u++)-1==g.indexOf(_[u])&&_[u]instanceof e.BlockView&&g.push(_[u]);if(0==e.DOWN_ROUND[main_round]&&g.sort(function(e,t){return e.order-t.order}),g.length){this.stepCount--;for(var m=g.length-1;m>=0;m--)this.clearLength++,this.clearAnimation(g[m],m)}}}}}else this._selectBlock=[null,null];else if(0==this.touchStatus){if(e.bBlock(t.target)){var d=t.target;this.alpha=1,this.uiView.tip_text.text="";var f=t.target,w=[];if(1==f.lineClearIce.visible){this.clearLength=0;for(var u=0;10>u;u++)this.colorVec[u][d.row]&&(this.clearLength++,w.push(this.blockMap[u][d.row]));for(var m=w.length-1;m>=0;m--)this.clearAnimation(w[m],m)}else this.clearLength=1,this.clearAnimation(f,0);this.touchStatus=1}}else if(e.bBlock(t.target)){this.alpha=1,this.uiView.tip_text.text="";var f=t.target;f.lineClearIce.visible=!0,this.touchStatus=1}},o.prototype.clearAnimation=function(t,o){var i=this;if(console.log(this.clearLength),t instanceof e.BlockView){var a=t.row,c=t.column;console.log("clearAnimation"),0==e.DOWN_ROUND[main_round]?(this.blockMap[c].splice(a,1),this.colorVec[c].splice(a,1)):(this.blockMap[c][a]=null,this.colorVec[c][a]=-1),this.touchEnabled=!1,this.touchChildren=!1,egret.Tween.get(t).to({scaleX:0,scaleY:0},800).call(function(){if(1==e.OVER_CONF[main_round]?(t.Value==i.clearColor&&i.clearCount--,i.clearCount<0&&(i.clearCount=0)):2==e.OVER_CONF[main_round]&&(i.lockVec[c][a]&&(i.clearCount--,i.lockVec[c][a]=0,i.lockMap[c][a].visible=!1),i.clearCount<0&&(i.clearCount=0)),i.animalContainer.removeChild(t),i.gameScore++,i.uiView.score.text=""+i.gameScore,i.uiView.stepCount.text=""+i.stepCount,(1==e.OVER_CONF[main_round]||2==e.OVER_CONF[main_round])&&(i.uiView.colorCount.text="剩"+i.clearCount),0==o){console.log("loop");var r=i;3==e.DOWN_ROUND[main_round]?setTimeout(function(){r.downLogic.downSkew()},150):setTimeout(function(){r.downLogic.downAnimal()},150)}})}},o.prototype.createAnimal=function(){if(this.touchEnabled=!1,this.touchChildren=!0,0==e.DOWN_ROUND[main_round])for(var t=0;10>t;t++){var o=12-this.colorVec[t].length;if(0!=o)for(var i=function(o){var i=a.colorVec[t].length;if(1==e.Block_Conf[main_round][t][i]){var c=new e.BlockView(i,t,0),r=11+o;a.animalContainer.addChild(c),a.clearLength--;var l=setInterval(function(){r>=i?(11>=r&&(c.visible=!0),c.y=825-50*r,r--):clearInterval(l)},200),n=Math.ceil(6*Math.random());a.colorVec[t][i]=n,c.Value=n,a.blockMap[t].push(c)}},a=this,c=0;o>c;c++)i(c)}else if(1==e.DOWN_ROUND[main_round])for(var t=0;10>t;t++){for(var r=0,l=0;12>l;l++)-1==this.colorVec[t][l]&&r++;for(var n=function(o){if(-1==s.colorVec[t][o]&&r>0){r--;var i=new e.BlockView(o,t,0),a=11+r;s.animalContainer.addChild(i),s.clearLength--,s.colorVec[t][o]=Math.ceil(6*Math.random()),s.blockMap[t][o]=i,i.Value=s.colorVec[t][o];var c=setInterval(function(){a>=o?(11>=a&&(i.visible=!0),i.y=825-50*a,a--):clearInterval(c)},200)}},s=this,l=11;l>0;l--)n(l)}else if(2==e.DOWN_ROUND[main_round])for(var t=0;10>t;t++)for(var l=0;12>l;l++)if(-1==this.colorVec[t][l]){var h=new e.BlockView(l,t,1);this.animalContainer.addChild(h),this.clearLength--,h.scaleX=0,h.scaleY=0;var u=Math.ceil(6*Math.random());this.colorVec[t][l]=u,h.Value=u,this.blockMap[t][l]=h,egret.Tween.get(h).to({scaleX:1,scaleY:1},200)}},o.prototype.createAnimalEntry=function(){console.log("2->方块生成");for(var t=e.DOWN_CONF[main_round].beginIndex,o=e.DOWN_CONF[main_round].endIndex,i=0,a=t;o>=a;a++)if(-1==this.colorVec[a][11]){i++,console.log("new");var c=new e.BlockView(11,a,1);this.animalContainer.addChild(c),this.blockMap[a][11]=c;var r=Math.ceil(6*Math.random());this.colorVec[a][11]=r,this.blockMap[a][11].Value=r,this.clearLength--}if(this.clearLength){console.log("this.clearLength",this.clearLength);var l=this;l.downLogic.createAnimalPlus()}else{var n=this;setTimeout(function(){var t;if(t=n.gameLogic.globalClear(),n.clearLength=t.length,t.length)n.gameLogic.clearAll(t);else{var o=e.deepCopy(n.colorVec);n.saveColorVec.push(o);var i=e.deepCopy(n.lockVec);n.saveLockVec.push(i),n.saveGameScore.push(n.gameScore),n.saveStepCount.push(n.stepCount),n.saveClearCount.push(n.clearCount),n.gameLogic.DeafCheck(o),n.touchEnabled=!0,n.touchChildren=!0,n.gameLogic.bOver()}},120)}},o.prototype.turnBack=function(){if(this.saveColorVec.length>1&&this.backCount<5){this.backCount++;var t=this.saveColorVec.length,o=this.saveLockVec.length,i=this.saveColorVec[t-2],a=this.saveLockVec[o-2];this.gameScore=this.saveGameScore[this.saveGameScore.length-2],this.clearCount=this.saveClearCount[this.saveGameScore.length-2],this.stepCount=this.saveStepCount[this.saveStepCount.length-2],this.saveLockVec.splice(o-2,1),this.saveColorVec.splice(t-2,1),this.saveGameScore.splice(this.saveGameScore.length-2,1),e.OVER_CONF[main_round]>0&&this.saveClearCount.splice(this.saveClearCount.length-2,1),this.saveStepCount.splice(this.saveStepCount.length-2,1),e.OVER_CONF[main_round]>0&&(this.uiView.colorCount.text="剩"+this.clearCount),this.uiView.score.text=""+this.gameScore,this.uiView.stepCount.text=""+this.stepCount;for(var c=0;10>c;c++)for(var r=0;12>r;r++)i[c][r]>0&&(this.blockMap[c][r].Value=i[c][r]),a[c][r]&&this.lockMap[c][r]&&(this.lockMap[c][r].visible=!0);this.lockVec=a,this.colorVec=i}else alert("不能后退了")},o}(egret.DisplayObjectContainer);e.GameStartView=t,__reflect(t.prototype,"happyClear.GameStartView",["happyClear.IGameStartView"])}(happyClear||(happyClear={}));var happyClear;!function(e){e.OVER_CONF={1:0,2:0,3:1,4:1,5:1,6:2,7:2},e.STEP_SCORE={1:[20,90],2:[20,100],3:[30,105],4:[25,110],5:[25,100],6:[25,105],7:[27,105]},e.COLOR_NUM={1:18,2:20,3:22,4:22,5:24,6:25,7:22},e.LOCK_CONF={1:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],2:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,1,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],3:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],4:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,1,0,0],[0,1,1,0,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],5:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],6:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],7:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,1,0,0,0,0],[0,0,1,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,0,1,0,0,0],[0,1,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]]}}(happyClear||(happyClear={}));var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,o,i){function a(e){t.call(i,e)}function c(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,c,null),o.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,c,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var happyClear;!function(e){e.Block_Conf={1:[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1]],2:[[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2]],3:[[1,1,1,0,1,1,1,1,1,-2,-2,-2],[1,1,1,0,1,1,1,1,0,1,-2,-2],[1,1,1,0,1,1,1,1,1,1,1,-2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,0,1,1,1,1,1,1,1,-2],[1,1,1,0,1,1,1,1,0,1,-2,-2],[1,1,1,0,1,1,1,1,1,-2,-2,-2]],4:[[-2,1,1,0,1,1,1,1,1,-2,-2,-2],[1,1,1,1,1,1,1,1,0,1,-2,-2],[1,1,1,0,1,1,1,0,1,1,1,-2],[1,1,1,0,1,1,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,0,1,1,1,1,1,1,1,2],[1,1,1,0,1,1,1,0,1,1,1,-2],[1,1,1,1,1,1,1,1,0,1,-2,-2],[-2,1,1,0,1,1,1,1,1,-2,-2,-2]],5:[[-2,1,1,1,0,1,1,1,1,-2,-2,2],[-2,1,1,1,0,1,1,1,0,1,1,-2],[1,1,1,1,1,1,1,0,1,1,1,-2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,-2],[-2,1,1,1,0,1,1,1,0,1,1,-2],[-2,1,1,1,0,1,1,1,1,-2,-2,2]],6:[[1,1,1,0,1,1,1,1,1,0,1,2],[1,1,1,0,1,1,1,1,1,1,0,2],[1,1,1,0,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,0,1,1,1,1,2],[1,1,1,1,1,1,0,1,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,0,1,1,1,1,1,1,1,0],[1,1,1,0,1,1,1,1,1,1,0,2],[1,1,1,0,1,1,1,1,1,0,1,2]],7:[[1,1,1,1,1,0,1,1,1,1,1,0],[1,1,1,1,1,0,1,1,1,1,0,2],[1,1,1,1,1,0,1,1,1,0,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,0,1,2],[1,1,1,1,1,0,1,1,1,1,0,2],[1,1,1,1,1,0,1,1,1,1,1,0]]},e.DOWN_ROUND={1:0,2:1,3:2,4:3,5:3,6:3,7:3},e.DOWN_CONF={1:{beginIndex:0,endIndex:9},2:{beginIndex:0,endIndex:9},3:{beginIndex:3,endIndex:6},4:{beginIndex:3,endIndex:6},5:{beginIndex:0,endIndex:9},6:{beginIndex:0,endIndex:9},7:{beginIndex:0,endIndex:9}};var t=function(t){function o(e){var o=t.call(this)||this;return o._gameStartView=e,o.addEventListener(egret.Event.ADDED_TO_STAGE,o.init,o),o}return __extends(o,t),o.prototype.init=function(){this._blockValue=this.getValue(),this.colorVec=this._blockValue,this.colorVec=this.flashValue(this.colorVec),this._gameStartView.onStart(this.colorVec)},o.prototype.getValue=function(){for(var t=[],o=0;10>o;o++){t[o]=[];for(var i=0;12>i;i++)if(e.Block_Conf[main_round][o][i]>0){var a=Math.ceil(6*Math.random());t[o].push(a)}else 0==e.Block_Conf[main_round][o][i]?t[o].push(0):t[o].push(null)}return t},o.prototype.flashValue=function(e){for(var t=0,o=0;10>o;o++)for(var i=0;12>i;i++)if(this.colorVec[o][i]){var a=this.canClear(e,i,o);if(a){t++;var c=Math.ceil(6*Math.random());c!=this.colorVec[o][i]&&(e[o][i]=c)}}return 0!=t&&this.flashValue(e),e},o.prototype.canClear=function(e,t,o){for(var i=1,a=o+1;10>a&&e[a][t]==e[o][t];a++)i++;for(var a=o-1;a>=0&&e[a][t]==e[o][t];a--)i++;for(var c=1,r=t+1;12>r&&e[o][r]==e[o][t];r++)c++;for(var r=t-1;r>=0&&e[o][r]==e[o][t];r--)c++;return i>=3||c>=3?i>=3&&c>=3?3:i>=3?1:c>=3?2:void 0:0},o}(egret.DisplayObjectContainer);e.GameData=t,__reflect(t.prototype,"happyClear.GameData",["happyClear.IGameData"])}(happyClear||(happyClear={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){var e=new egret.Bitmap;e.texture=RES.getRes("HHC_bg_png"),this.addChild(e),e.x=0,e.y=0,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){var o=Math.floor(e&100/t);this.textField.text="Loading..."+o+"%",this.textField.anchorOffsetX=this.textField.width/2,this.textField.anchorOffsetY=this.textField.height/2,this.textField.x=this.stage.stageWidth/2,this.textField.y=this.stage.stageHeight/2},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,o){function i(i){t.call(o,i,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?i(a):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var happyClear;!function(e){var t=function(t){function o(e){var o=t.call(this)||this;return o._gameView=e,o}return __extends(o,t),o.prototype.downAnimal=function(){this.touchEnabled=!1,this.touchChildren=!0;var t=0;if(0==e.DOWN_ROUND[main_round])for(var o=0;10>o;o++)for(var i=this._gameView.colorVec[o].length,a=0;i>a;a++){var c=this._gameView.blockMap[o].indexOf(this._gameView.blockMap[o][a]);if(c!=this._gameView.blockMap[o][a].row){var r=this._gameView.blockMap[o][a].row-c;r>=t&&(t=r),this._gameView.blockMap[o][a].row=c,this._gameView.blockMap[o][a].order=10*this._gameView.blockMap[o][a].column+this._gameView.blockMap[o][a].row,this._gameView.blockMap[o][a].y=825-50*c}}else if(1==e.DOWN_ROUND[main_round]){for(var l=0;10>l;l++)for(var n=1;12>n;n++)if(this._gameView.colorVec[l][n]>0&&(-1==this._gameView.colorVec[l][n-1]||0==this._gameView.colorVec[l][n-1])){for(var s=0,h=n-1;h>=0;h--)if(-1==this._gameView.colorVec[l][h])s++;else{if(0!=this._gameView.colorVec[l][h]||-1!=this._gameView.colorVec[l][h-1])break;h--,s+=2}s&&(this._gameView.blockMap[l][n].row=n-s,this._gameView.blockMap[l][n].y=825-50*(n-s),this._gameView.colorVec[l][n-s]=this._gameView.colorVec[l][n],this._gameView.blockMap[l][n-s]=this._gameView.blockMap[l][n],this._gameView.colorVec[l][n]=-1,this._gameView.blockMap[l][n]=null),s>t&&(t=s)}}else if(2==e.DOWN_ROUND[main_round])for(var o=0;10>o;o++)for(var a=1;12>a;a++)if(this._gameView.colorVec[o][a]>0&&-1==this._gameView.colorVec[o][a-1]){for(var s=0,h=a-1;h>=0&&-1==this._gameView.colorVec[o][h];h--)s++;this._gameView.blockMap[o][a].row=a-s,this._gameView.blockMap[o][a].y=825-50*(a-s),this._gameView.colorVec[o][a-s]=this._gameView.colorVec[o][a],this._gameView.blockMap[o][a-s]=this._gameView.blockMap[o][a],this._gameView.colorVec[o][a]=-1,this._gameView.blockMap[o][a]=null}var u;u=250*(t+1),console.log("2"),1==main_round&&(u=250*(t+1));var g=this;setTimeout(function(){g._gameView.createAnimal()},20),setTimeout(function(){var t;if(t=g._gameView.gameLogic.globalClear(),g._gameView.clearLength=t.length,t.length)g._gameView.gameLogic.clearAll(t);else{var o=e.deepCopy(g._gameView.colorVec);g._gameView.saveColorVec.push(o);var i=e.deepCopy(g._gameView.lockVec);g._gameView.saveLockVec.push(i),g._gameView.gameLogic.DeafCheck(o),g._gameView.saveGameScore.push(g._gameView.gameScore),g._gameView.saveStepCount.push(g._gameView.stepCount),g._gameView.saveClearCount.push(g._gameView.clearCount),console.log(g._gameView.colorVec),g.touchEnabled=!0,g.touchChildren=!0,g._gameView.gameLogic.bOver()}},u)},o.prototype.downSkew=function(){console.log("4");for(var e=0;10>e;e++)for(var t=1;12>t;t++)if(this._gameView.colorVec[e][t]>0&&-1==this._gameView.colorVec[e][t-1]){for(var o=0,i=t-1;i>=0&&-1==this._gameView.colorVec[e][i];i--)o++;this._gameView.blockMap[e][t].row=t-o,this._gameView.blockMap[e][t].downStatus=0,this._gameView.blockMap[e][t].y=825-50*(t-o),this._gameView.colorVec[e][t-o]=this._gameView.colorVec[e][t],this._gameView.blockMap[e][t-o]=this._gameView.blockMap[e][t],this._gameView.colorVec[e][t]=-1,this._gameView.blockMap[e][t]=null}this.createAnimalPlus()},o.prototype.createAnimalPlus=function(){var e=this;this._gameView.touchEnabled=!1,this._gameView.touchChildren=!1;var t=0;if(this._gameView.clearLength){console.log("1->方块斜滑");for(var o=function(o){for(var a=function(a){i._gameView.colorVec[o][a]>0&&i._gameView.blockMap[o][a]&&(-1==i._gameView.colorVec[o][a-1]?(i._gameView.colorVec[o][a-1]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].row=a-1,i._gameView.blockMap[o][a].column=o,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*i._gameView.blockMap[o][a].column,y:825-50*i._gameView.blockMap[o][a].row},80).call(function(){console.log("原"+a+"行"+o+"列方块"),e._gameView.blockMap[o][a-1]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功 下滑")}),t++):i._gameView.blockMap[o][a].downStatus?o>0&&9>o&&(1==i._gameView.blockMap[o][a].downStatus&&-1==i._gameView.colorVec[o-1][a]?(i._gameView.colorVec[o-1][a]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].column=o-1,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*(o-1)},80).call(function(){console.log("原"+a+"行"+o+"列方块"),console.log(e._gameView.blockMap[o][a]),e._gameView.blockMap[o-1][a]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功 左滑")}),t++):2==i._gameView.blockMap[o][a].downStatus&&-1==i._gameView.colorVec[o+1][a]?(i._gameView.colorVec[o+1][a]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].column=o+1,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*(o+1)},80).call(function(){console.log("原"+a+"行"+o+"列方块"),console.log(e._gameView.blockMap[o][a]),e._gameView.blockMap[o+1][a]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功 右滑")}),t++):i._gameView.blockMap[o][a].downStatus=0):o>0&&9>o?0!=i._gameView.colorVec[o-1][a]&&null!=i._gameView.colorVec[o-1][a]||-1!=i._gameView.colorVec[o-1][a-1]?0!=i._gameView.colorVec[o+1][a]&&null!=i._gameView.colorVec[o+1][a]||-1!=i._gameView.colorVec[o+1][a-1]||(i._gameView.colorVec[o+1][a-1]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].row=a-1,i._gameView.blockMap[o][a].column=o+1,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*i._gameView.blockMap[o][a].column,y:825-50*i._gameView.blockMap[o][a].row},80).call(function(){console.log("原"+a+"行"+o+"列方块"),e._gameView.blockMap[o][a].downStatus=2,e._gameView.blockMap[o+1][a-1]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功+状态右滑")}),t++):(i._gameView.colorVec[o-1][a-1]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].row=a-1,i._gameView.blockMap[o][a].column=o-1,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*i._gameView.blockMap[o][a].column,y:825-50*i._gameView.blockMap[o][a].row},80).call(function(){console.log("原"+a+"行"+o+"列方块"),e._gameView.blockMap[o][a].downStatus=1,e._gameView.blockMap[o-1][a-1]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功，+ 状态左滑")}),t++):0==o?0!=i._gameView.colorVec[o+1][a]&&null!=i._gameView.colorVec[o+1][a]||-1!=i._gameView.colorVec[o+1][a-1]||(i._gameView.colorVec[o+1][a-1]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].row=a-1,i._gameView.blockMap[o][a].column=o+1,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*i._gameView.blockMap[o][a].column,y:825-50*i._gameView.blockMap[o][a].row},80).call(function(){console.log("原"+a+"行"+o+"列方块"),e._gameView.blockMap[o][a].downStatus=2,e._gameView.blockMap[o+1][a-1]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功")}),t++):0!=i._gameView.colorVec[o-1][a]&&null!=i._gameView.colorVec[o-1][a]||-1!=i._gameView.colorVec[o-1][a-1]||(i._gameView.colorVec[o-1][a-1]=i._gameView.colorVec[o][a],i._gameView.blockMap[o][a].row=a-1,i._gameView.blockMap[o][a].column=o-1,egret.Tween.get(i._gameView.blockMap[o][a]).to({x:145+50*i._gameView.blockMap[o][a].column,y:825-50*i._gameView.blockMap[o][a].row},80).call(function(){console.log("原"+a+"行"+o+"列方块"),e._gameView.blockMap[o][a].downStatus=1,e._gameView.blockMap[o-1][a-1]=e._gameView.blockMap[o][a],e._gameView.blockMap[o][a]=null,e._gameView.colorVec[o][a]=-1,console.log("数组赋值成功,方块左滑")}),t++))},c=1;12>c;c++)a(c)},i=this,a=0;10>a;a++)o(a)}if(this._gameView.clearLength&&0==t){for(var c=function(o){for(var i=function(i){r._gameView.colorVec[o][i]&&r._gameView.blockMap[o][i]&&(0!=r._gameView.colorVec[o][i+1]&&null!=r._gameView.colorVec[o][i+1]||0!=r._gameView.colorVec[o-1][i+1]&&null!=r._gameView.colorVec[o-1][i+1]||(-1==r._gameView.colorVec[o-1][i-1]?(r._gameView.colorVec[o-1][i-1]=r._gameView.colorVec[o][i],r._gameView.blockMap[o][i].row=i-1,r._gameView.blockMap[o][i].column=o-1,egret.Tween.get(r._gameView.blockMap[o][i]).to({x:145+50*r._gameView.blockMap[o][i].column,y:825-50*r._gameView.blockMap[o][i].row},80).call(function(){console.log("原"+i+"行"+o+"列方块"),e._gameView.blockMap[o][i].downStatus=1,e._gameView.blockMap[o-1][i-1]=e._gameView.blockMap[o][i],e._gameView.blockMap[o][i]=null,e._gameView.colorVec[o][i]=-1,console.log("数组赋值成功，左下滑")}),t++):-1==r._gameView.colorVec[o-1][i]&&(r._gameView.colorVec[o-1][i]=r._gameView.colorVec[o][i],r._gameView.blockMap[o][i].column=o-1,egret.Tween.get(r._gameView.blockMap[o][i]).to({x:145+50*(o-1)},80).call(function(){console.log("原"+i+"行"+o+"列方块"),e._gameView.blockMap[o][i].downStatus=1,e._gameView.blockMap[o-1][i]=e._gameView.blockMap[o][i],e._gameView.blockMap[o][i]=null,e._gameView.colorVec[o][i]=-1,console.log("数组赋值成功，左滑")}),t++)))},a=1;11>a;a++)i(a)},r=this,a=1;7>a;a++)c(a);for(var l=function(o){for(var i=function(i){n._gameView.colorVec[o][i]&&n._gameView.blockMap[o][i]&&(0!=n._gameView.colorVec[o][i+1]&&null!=n._gameView.colorVec[o][i+1]||0!=n._gameView.colorVec[o+1][i+1]&&null!=n._gameView.colorVec[o+1][i+1]||(-1==n._gameView.colorVec[o+1][i-1]?(n._gameView.colorVec[o+1][i-1]=n._gameView.colorVec[o][i],n._gameView.blockMap[o][i].row=i-1,n._gameView.blockMap[o][i].column=o+1,egret.Tween.get(n._gameView.blockMap[o][i]).to({x:145+50*n._gameView.blockMap[o][i].column,y:825-50*n._gameView.blockMap[o][i].row},80).call(function(){console.log("原"+i+"行"+o+"列方块"),e._gameView.blockMap[o][i].downStatus=2,e._gameView.blockMap[o+1][i-1]=e._gameView.blockMap[o][i],e._gameView.blockMap[o][i]=null,e._gameView.colorVec[o][i]=-1,console.log("数组赋值成功，右下滑")
}),t++):-1==n._gameView.colorVec[o+1][i]&&(n._gameView.colorVec[o+1][i]=n._gameView.colorVec[o][i],n._gameView.blockMap[o][i].column=o+1,egret.Tween.get(n._gameView.blockMap[o][i]).to({x:145+50*(o+1)},80).call(function(){console.log("原"+i+"行"+o+"列方块"),e._gameView.blockMap[o][i].downStatus=2,e._gameView.blockMap[o+1][i]=e._gameView.blockMap[o][i],e._gameView.blockMap[o][i]=null,e._gameView.colorVec[o][i]=-1,console.log("数组赋值成功，右滑")}),t++)))},a=1;11>a;a++)i(a)},n=this,a=3;9>a;a++)l(a)}if(this._gameView.clearLength){var s=this;setTimeout(function(){console.log(t+"->num"),s._gameView.createAnimalEntry()},90)}},o}(egret.DisplayObjectContainer);e.DownLogic=t,__reflect(t.prototype,"happyClear.DownLogic")}(happyClear||(happyClear={}));var happyClear;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.drawTable,t),t}return __extends(t,e),t.prototype.drawTable=function(){var e=new egret.Shape;e.graphics.lineStyle(1,2003199),e.graphics.moveTo(120,250),e.graphics.lineTo(620,250),e.graphics.lineTo(620,850),e.graphics.lineTo(120,850),e.graphics.lineTo(120,250),e.graphics.endFill(),this.addChild(e)},t}(egret.DisplayObjectContainer);e.DrawTable=t,__reflect(t.prototype,"happyClear.DrawTable")}(happyClear||(happyClear={}));var happyClear;!function(e){function t(t){return t instanceof e.BlockView?t:null}function o(e){if("object"!=typeof e)return e;var t={};for(var i in e)t[i]=o(e[i]);return t}function i(e){var t={};for(var o in e)t[o]=e[o];return t}function a(e){for(var t=0;10>t;t++)for(var o=0;12>o;o++){if(8>t&&e[t][o]==e[t+1][o]&&e[t][o]==e[t+2][o])return!1;if(10>o&&e[t][o]==e[t][o+1]&&e[t][o+1]==e[t][o+2])return!1}return!0}e.bBlock=t,e.deepCopy=o,e.copy=i,e.checkClear=a;var c=function(t){function o(e){var o=t.call(this)||this;return o._gameView=e,o}return __extends(o,t),o.prototype.DeafCheck=function(e){var t;e:for(var o=0;9>o;o++){for(var i=0;11>i;i++){var c=e[o][i];e[o][i]=e[o][i+1],e[o][i+1]=c;var r=a(e);if(!r){e[o][i+1]=e[o][i],e[o][i]=c,t=!1;break e}e[o][i+1]=e[o][i],e[o][i]=c,e[o][i]=e[o+1][i],e[o+1][i]=c;var l=a(e);if(!l){e[o+1][i]=e[o][i],e[o][i]=c,t=!1;break e}e[o+1][i]=e[o][i],e[o][i]=c}t=!0}t&&alert("当前没有可以消的，游戏结束")},o.prototype.canClear=function(e,t){for(var o=1,i=t+1;10>i&&(this._gameView.colorVec[i][e]==this._gameView.colorVec[t][e]&&0!=this._gameView.colorVec[i][e]&&null!=this._gameView.colorVec[i][e]);i++)o++;for(var i=t-1;i>=0&&(this._gameView.colorVec[i][e]==this._gameView.colorVec[t][e]&&0!=this._gameView.colorVec[i][e]&&null!=this._gameView.colorVec[i][e]);i--)o++;for(var a=1,c=e+1;12>c&&(this._gameView.colorVec[t][c]==this._gameView.colorVec[t][e]&&0!=this._gameView.colorVec[t][c]&&null!=this._gameView.colorVec[t][c]);c++)a++;for(var c=e-1;c>=0&&(this._gameView.colorVec[t][c]==this._gameView.colorVec[t][e]&&0!=this._gameView.colorVec[t][c]&&null!=this._gameView.colorVec[t][c]);c--)a++;return o>=3||a>=3?o>=3&&a>=3?3:o>=3?1:a>=3?2:void 0:0},o.prototype.getClearList=function(t,o,i){switch(t){case 1:for(var a=[],c=i-1;c>=0&&this._gameView.colorVec[i][o]==this._gameView.colorVec[c][o];c--)a.unshift(this._gameView.blockMap[c][o]);a.push(this._gameView.blockMap[i][o]);for(var c=i+1;10>c&&this._gameView.colorVec[i][o]==this._gameView.colorVec[c][o];c++)a.push(this._gameView.blockMap[c][o]);return a;case 2:for(var r=[],l=o-1;l>=0&&this._gameView.colorVec[i][l]==this._gameView.colorVec[i][o];l--)r.unshift(this._gameView.blockMap[i][l]);r.push(this._gameView.blockMap[i][o]);for(var l=o+1;12>=l&&this._gameView.colorVec[i][l]==this._gameView.colorVec[i][o];l++)r.push(this._gameView.blockMap[i][l]);return r;case 3:for(var n=[],c=i-1;c>=0&&this._gameView.colorVec[i][o]==this._gameView.colorVec[c][o];c--)n.unshift(this._gameView.blockMap[c][o]);n.push(this._gameView.blockMap[i][o]);for(var c=i+1;10>c&&this._gameView.colorVec[i][o]==this._gameView.colorVec[c][o];c++)n.push(this._gameView.blockMap[c][o]);for(var s=[],l=o-1;l>=0&&this._gameView.colorVec[i][l]==this._gameView.colorVec[i][o];l--)s.unshift(this._gameView.blockMap[i][l]);for(var l=o+1;12>=l&&this._gameView.colorVec[i][l]==this._gameView.colorVec[i][o];l++)s.push(this._gameView.blockMap[i][l]);var h=n.concat(s);return 0==e.DOWN_ROUND[main_round]&&h.sort(function(e,t){return e.order-t.order}),h;case 0:return[]}},o.prototype.globalClear=function(){for(var t=[],o=0;10>o;o++)for(var i=0;12>i;i++){var a=this.canClear(i,o),c=[];c=this.getClearList(a,i,o);for(var r=0;r<c.length;r++)-1==t.indexOf(c[r])&&c[r]instanceof e.BlockView&&t.push(c[r])}return 0==e.DOWN_ROUND[main_round]&&t.sort(function(e,t){return e.order-t.order}),this._gameView.firstFlag=!1,t},o.prototype.clearAll=function(e){for(var t=e.length-1;t>=0;t--)this._gameView.clearAnimation(e[t],t)},o.prototype.gameOver=function(){for(var t=0;10>t;t++)for(var o=0;12>o;o++)this._gameView.blockMap[t][o]instanceof e.BlockView&&this._gameView.animalContainer.removeChild(this._gameView.blockMap[t][o]),this._gameView.lockMap[t][o]&&this._gameView.lockContainer.removeChild(this._gameView.lockMap[t][o]);this._gameView.blockMap=[],this._gameView.colorVec=[],this._gameView.lockMap=[],this._gameView.saveColorVec=[],this._gameView.saveLockVec=[],this._gameView.saveStepCount=[],this._gameView.saveGameScore=[],this._gameView.saveClearCount=[],this._gameView.backCount=0,this._gameView.gameScore=0,this._gameView.clearLength=0,this._gameView.clearCount=0,this._gameView.uiView.colorCount.text="",1==e.OVER_CONF[main_round]&&(this._gameView.uiView.target_score.visible=!0),this._gameView.animalInfo&&(this._gameView.animalContainer.removeChild(this._gameView.animalInfo),this._gameView.animalInfo=null),this._gameView.gameData.init()},o.prototype.bOver=function(){1==e.OVER_CONF[main_round]||2==e.OVER_CONF[main_round]?this._gameView.stepCount<=0&&this._gameView.clearCount>0?(alert("游戏结束"),this.gameOver()):this._gameView.stepCount>=0&&this._gameView.clearCount<=0&&(alert("恭喜过关"),main_round>=7?main_round=1:main_round++,this.gameOver()):0==e.OVER_CONF[main_round]&&(console.log("目前分数",this._gameView.gameScore,"通关分数",e.STEP_SCORE[main_round][1]),this._gameView.stepCount<=0&&this._gameView.gameScore<e.STEP_SCORE[main_round][1]?(alert("游戏结束"),this.gameOver()):this._gameView.stepCount>=0&&this._gameView.gameScore>=e.STEP_SCORE[main_round][1]&&(alert("恭喜通关"),main_round>=7?main_round=1:main_round++,this.gameOver()))},o}(egret.DisplayObjectContainer);e.GameLogic=c,__reflect(c.prototype,"happyClear.GameLogic",["happyClear.IGameLogic"])}(happyClear||(happyClear={}));var BlockView=happyClear.BlockView,GameStartView=happyClear.GameStartView,main_round=1,Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(o){return e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},t=new AssetAdapter,egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),[2]})})},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName?(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene()):(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.loadGroup("preload"))},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){var e=new GameStartView;this.addChild(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,o=RES.getRes(e);return t.texture=o,t},t.prototype.startAnimation=function(e){var t=this,o=new egret.HtmlTextParser,i=e.map(function(e){return o.parse(e)}),a=this.textfield,c=-1,r=function(){c++,c>=i.length&&(c=0);var e=i[c];a.textFlow=e;var o=egret.Tween.get(a);o.to({alpha:1},200),o.wait(2e3),o.to({alpha:0},200),o.call(r,t)};r()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var happyClear;!function(e){var t=function(t){function o(e){var o=t.call(this)||this;return o._gameStartView=e,o.skinName="HC_TableViewSkin",o.front_round.touchEnabled=!0,o.next_round.touchEnabled=!0,o.refresh_btn.touchEnabled=!0,o.hammer_btn.touchEnabled=!0,o.addStepCount_btn.touchEnabled=!0,o.magicWand_btn.touchEnabled=!0,o.back_btn.touchEnabled=!0,o.front_round.addEventListener(egret.TouchEvent.TOUCH_TAP,o.turnFront,o),o.next_round.addEventListener(egret.TouchEvent.TOUCH_TAP,o.turnNext,o),o.refresh_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onRefresh,o),o.addStepCount_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onAddStepCount,o),o.hammer_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onClickHammer,o),o.magicWand_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onClickMagicWand,o),o.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onBack,o),o}return __extends(o,t),o.prototype.turnFront=function(){1>=main_round?main_round=7:main_round--,this._gameStartView.gameLogic.gameOver()},o.prototype.turnNext=function(){main_round>=7?main_round=1:main_round++,this._gameStartView.gameLogic.gameOver()},o.prototype.onRefresh=function(){for(var t=this._gameStartView.colorVec,o=this._gameStartView.blockMap,i=0;10>i;i++)for(var a=0;12>a;a++)t[i][a]&&(t[i][a]=Math.ceil(6*Math.random()));t=this._gameStartView.gameData.flashValue(t);for(var i=0;10>i;i++)for(var a=0;12>a;a++)t[i][a]&&(o[i][a].Value=t[i][a]);var c,r=this._gameStartView;if(c=r.gameLogic.globalClear(),r.clearLength=c.length,c.length)r.gameLogic.clearAll(c);else{var l=e.deepCopy(r.colorVec),n=e.deepCopy(r.lockVec);r.saveColorVec.push(l),r.saveLockVec.push(n),r.saveGameScore.push(r.gameScore),r.saveStepCount.push(r.stepCount),r.saveClearCount.push(r.clearCount),r.gameLogic.DeafCheck(l),r.touchEnabled=!0,r.touchChildren=!0,r.gameLogic.bOver()}},o.prototype.onAddStepCount=function(){this._gameStartView.stepCount+=5,this.stepCount.text=""+this._gameStartView.stepCount},o.prototype.onClickHammer=function(){this.tip_text.text="请点击要消除的动物",this._gameStartView.alpha=.9,this._gameStartView.touchStatus=0},o.prototype.onClickMagicWand=function(){this.tip_text.text="请点击要行列消除特效的动物",this._gameStartView.alpha=.8,this._gameStartView.touchStatus=2},o.prototype.onBack=function(){this._gameStartView.turnBack()},o.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o)},o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},o}(eui.Component);e.UIView=t,__reflect(t.prototype,"happyClear.UIView",["eui.UIComponent","egret.DisplayObject"])}(happyClear||(happyClear={}));