var __reflect=this&&this.__reflect||function(e,o,t){e.__class__=o,t?t.push(o):t=[o],e.__types__=e.__types__?t.concat(e.__types__):t},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])};return function(o,t){function i(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),happyClear;!function(e){var o="hc_animal_%d_png",t=function(e){function t(o,t,i){var a=e.call(this)||this;return a.downStatus=0,a.position={x:null,y:null},1==i?(a.position.x=145+50*t,a.position.y=825-50*o):0==i?(a.position.x=145+50*t,a.position.y=225,a.visible=!1):(a.position.x=o,a.position.y=t),a._status=i,a.row=o,a.column=t,a.order=10*t+o,a.touchChildren=!1,a.touchEnabled=!0,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.initBlock,a),a}return __extends(t,e),Object.defineProperty(t.prototype,"Value",{get:function(){return this._value},set:function(e){this._value=e,this.displayByValue(e)},enumerable:!0,configurable:!0}),t.prototype.initBlock=function(){this.lockImg=new egret.Bitmap,this._block=new egret.Bitmap,this.lineClearIce=new egret.Bitmap,this.lockImg.texture=RES.getRes("hc_ice_png"),this.lineClearIce.texture=RES.getRes("hc_lock_png"),this.width=50,this.height=50,this.x=this.position.x,this.y=this.position.y,this.addChild(this._block),this.addChild(this.lineClearIce),this.addChild(this.lockImg),this.lineClearIce.alpha=.7,this.lineClearIce.visible=!1,this.lineClearIce.width=48,this.lineClearIce.height=48,this.lockImg.alpha=1,this.lockImg.visible=!1,this.lockImg.width=48,this.lockImg.height=48,this.lineClearIce.x=1,this.lineClearIce.y=1,this.lockImg.x=1,this.lockImg.y=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this._block.x=1,this._block.y=1,3==this._status?(this._block.width=32,this._block.height=32,this.lockImg.width=32,this.lockImg.height=32):(this._block.width=48,this._block.height=48)},t.prototype.displayByValue=function(e){this._block.texture=RES.getRes(o.replace("%d",e))},t}(egret.DisplayObjectContainer);e.BlockView=t,__reflect(t.prototype,"happyClear.BlockView")}(happyClear||(happyClear={}));var happyClear;!function(e){var o=function(o){function t(){var e=o.call(this)||this;return e.saveColorVec=[],e.saveLockVec=[],e.lockVec=[],e.stepCount=0,e.saveStepCount=[],e.gameScore=0,e.saveGameScore=[],e.firstFlag=!0,e.clearLength=0,e.clearCount=0,e.saveClearCount=[],e.touchStatus=1,e.backCount=0,e._selectBlock=[null,null],e.touchEnabled=!0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(t,o),t.prototype.init=function(){this.uiView=new e.UIView(this),this.addChild(this.uiView);var o=new e.DrawTable;this.addChild(o),this.animalContainer=new egret.DisplayObjectContainer,this.lockContainer=new egret.DisplayObjectContainer,this.addChild(this.animalContainer),this.addChild(this.lockContainer),this.gameData=new e.GameData(this),this.addChild(this.gameData),this.gameLogic=new e.GameLogic(this),this.downLogic=new e.DownLogic(this),this.addChild(this.gameLogic),this.addWatch()},t.prototype.addWatch=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.onStart=function(o){this.colorVec=o,this.blockMap=[],this.lockMap=[];var t=e.deepCopy(e.LOCK_CONF[main_round]);this.lockVec=t,this.saveLockVec.push(t);for(var i=0;10>i;i++){this.blockMap[i]=[],this.lockMap[i]=[];for(var a=0;12>a;a++)if(e.Block_Conf[main_round][i][a]>0){var c=new e.BlockView(a,i,1);this.blockMap[i].push(c),this.lockMap[i].push(null),this.animalContainer.addChild(c),c.Value=o[i][a]}else if(0==e.Block_Conf[main_round][i][a]){var c=new e.BlockView(a,i,1);this.animalContainer.addChild(c),c.Value=o[i][a],this.blockMap[i].push(c),this.lockMap[i].push(null)}else this.blockMap[i].push(null),this.lockMap[i].push(null)}if(this.saveColorVec.push(e.deepCopy(this.colorVec)),this.uiView.score.text=""+this.gameScore,this.uiView.roundInfo.text=""+main_round,0==e.OVER_CONF[main_round])this.clearColor=0,this.stepCount=e.STEP_SCORE[main_round][0],this.uiView.target_score.visible=!0,this.uiView.colorCount.text=""+e.STEP_SCORE[main_round][1];else if(1==e.OVER_CONF[main_round])this.clearColor=Math.ceil(6*Math.random()),this.animalInfo=new e.BlockView(500,160,3),this.animalContainer.addChild(this.animalInfo),this.animalInfo.Value=this.clearColor,this.stepCount=e.STEP_SCORE[main_round][0],this.clearCount=e.COLOR_NUM[main_round],this.uiView.target_score.visible=!1,this.uiView.colorCount.text="剩"+this.clearCount;else{this.clearColor=0,this.stepCount=e.STEP_SCORE[main_round][0],this.uiView.target_score.visible=!1,this.animalInfo=new e.BlockView(500,160,3),this.animalContainer.addChild(this.animalInfo),this.animalInfo.lockImg.visible=!0;for(var i=0;10>i;i++)for(var a=0;12>a;a++)if(1==e.LOCK_CONF[main_round][i][a]){var c=new e.BlockView(a,i,1);c.touchEnabled=!1,c.touchChildren=!1,this.lockContainer.addChild(c),this.lockMap[i][a]=c,c.lockImg.visible=!0,c.alpha=.9,this.clearCount++}else this.lockMap[i][a]=null;this.uiView.colorCount.text="剩"+this.clearCount}this.uiView.stepCount.text=""+this.stepCount,this.saveClearCount.push(this.clearCount),this.saveStepCount.push(this.stepCount),this.saveGameScore.push(this.gameScore)},t.prototype.onTouchBegin=function(o){this._selectBlock=[null,null],e.bBlock(o.target)&&o.target.Value&&(this._selectBlock[0]=o.target)},t.prototype.onTouchEnd=function(o){var t=this;if(1==this.touchStatus)if(e.bBlock(o.target)&&null!=this._selectBlock[0]){if(o.target.Value){var i=e.bBlock(o.target);if(!(i.row!=this._selectBlock[0].row&&i.column!=this._selectBlock[0].column||1!=Math.abs(i.row-this._selectBlock[0].row)&&1!=Math.abs(i.column-this._selectBlock[0].column)))if(this._selectBlock[1]=i,i.column==this._selectBlock[0].column){var a=this._selectBlock[0].row,c=i.row;egret.Tween.get(this._selectBlock[0]).to({y:825-50*c},100),egret.Tween.get(this._selectBlock[1]).to({y:825-50*a},100),this._selectBlock[0].row=c,this._selectBlock[1].row=a,this._selectBlock[0].order=10*this._selectBlock[0].column+this._selectBlock[0].row,this._selectBlock[1].order=10*this._selectBlock[1].column+this._selectBlock[1].row,this.colorVec[i.column][a]=this._selectBlock[1].Value,this.colorVec[i.column][c]=this._selectBlock[0].Value;var l=this.gameLogic.canClear(a,i.column),r=this.gameLogic.canClear(c,i.column);if(0==l&&0==r)setTimeout(function(){t._selectBlock[0].row=a,t._selectBlock[1].row=c,t._selectBlock[0].order=10*t._selectBlock[0].column+t._selectBlock[0].row,t._selectBlock[1].order=10*t._selectBlock[1].column+t._selectBlock[1].row,t.colorVec[i.column][a]=t._selectBlock[0].Value,t.colorVec[i.column][c]=t._selectBlock[1].Value,egret.Tween.get(t._selectBlock[0]).to({y:825-50*a},100),egret.Tween.get(t._selectBlock[1]).to({y:825-50*c},100)},100);else{this.blockMap[i.column][a]=this._selectBlock[1],this.blockMap[i.column][c]=this._selectBlock[0];var n=this.gameLogic.getClearList(l,a,i.column),s=this.gameLogic.getClearList(r,c,i.column),h=[];if(1==this._selectBlock[0].lineClearIce.visible&&r)for(var g=0;12>g;g++)this.colorVec[i.column][g]&&h.push(this.blockMap[i.column][g]);if(1==this._selectBlock[1].lineClearIce.visible&&l)for(var g=0;12>g;g++)this.colorVec[i.column][g]&&h.push(this.blockMap[i.column][g]);for(var u=[],m=n.concat(s).concat(h),g=0;g<m.length;g++)-1==u.indexOf(m[g])&&m[g]instanceof e.BlockView&&u.push(m[g]);if(0==e.DOWN_ROUND[main_round]&&u.sort(function(e,o){return e.order-o.order}),u.length){this.stepCount--;for(var _=u.length-1;_>=0;_--)this.clearLength++,this.clearAnimation(u[_],_)}}}else{var V=this._selectBlock[0].column,p=i.column;egret.Tween.get(this._selectBlock[0]).to({x:50*p+145},100),egret.Tween.get(this._selectBlock[1]).to({x:50*V+145},100),this._selectBlock[0].column=p,this._selectBlock[1].column=V,this._selectBlock[0].order=10*this._selectBlock[0].column+this._selectBlock[0].row,this._selectBlock[1].order=10*this._selectBlock[1].column+this._selectBlock[1].row,this.colorVec[V][i.row]=this._selectBlock[1].Value,this.colorVec[p][i.row]=this._selectBlock[0].Value;var l=this.gameLogic.canClear(i.row,V),r=this.gameLogic.canClear(i.row,p);if(0==l&&0==r)setTimeout(function(){t._selectBlock[0].column=V,t._selectBlock[1].column=p,t._selectBlock[0].order=10*t._selectBlock[0].column+t._selectBlock[0].row,t._selectBlock[1].order=10*t._selectBlock[1].column+t._selectBlock[1].row,t.colorVec[V][i.row]=t._selectBlock[0].Value,t.colorVec[p][i.row]=t._selectBlock[1].Value,egret.Tween.get(t._selectBlock[0]).to({x:50*V+145},100),egret.Tween.get(t._selectBlock[1]).to({x:50*p+145},100)},101);else{this.blockMap[V][i.row]=this._selectBlock[1],this.blockMap[p][i.row]=this._selectBlock[0];var n=this.gameLogic.getClearList(l,i.row,V),s=this.gameLogic.getClearList(r,i.row,p),w=[];if(1==this._selectBlock[0].lineClearIce.visible&&r)for(var g=0;10>g;g++)this.colorVec[g][i.row]&&w.push(this.blockMap[g][i.row]);if(1==this._selectBlock[1].lineClearIce.visible&&l)for(var g=0;10>g;g++)this.colorVec[g][i.row]&&w.push(this.blockMap[g][i.row]);for(var u=[],m=n.concat(s).concat(w),g=0;g<m.length;g++)-1==u.indexOf(m[g])&&m[g]instanceof e.BlockView&&u.push(m[g]);if(0==e.DOWN_ROUND[main_round]&&u.sort(function(e,o){return e.order-o.order}),u.length){this.stepCount--;for(var _=u.length-1;_>=0;_--)this.clearLength++,this.clearAnimation(u[_],_)}}}}}else this._selectBlock=[null,null];else if(0==this.touchStatus){if(e.bBlock(o.target)){var d=o.target;this.alpha=1,this.uiView.tip_text.text="";var f=o.target,w=[];if(1==f.lineClearIce.visible){this.clearLength=0;for(var g=0;10>g;g++)this.colorVec[g][d.row]&&(this.clearLength++,w.push(this.blockMap[g][d.row]));for(var _=w.length-1;_>=0;_--)this.clearAnimation(w[_],_)}else this.clearLength=1,this.clearAnimation(f,0);this.touchStatus=1}}else if(e.bBlock(o.target)){this.alpha=1,this.uiView.tip_text.text="";var f=o.target;f.lineClearIce.visible=!0,this.touchStatus=1}},t.prototype.clearAnimation=function(o,t){var i=this;if(console.log(this.clearLength),o instanceof e.BlockView){var a=o.row,c=o.column;console.log("clearAnimation"),0==e.DOWN_ROUND[main_round]?(this.blockMap[c].splice(a,1),this.colorVec[c].splice(a,1)):(this.blockMap[c][a]=null,this.colorVec[c][a]=-1),this.touchEnabled=!1,this.touchChildren=!1,egret.Tween.get(o).to({scaleX:0,scaleY:0},800).call(function(){if(1==e.OVER_CONF[main_round]?(o.Value==i.clearColor&&i.clearCount--,i.clearCount<0&&(i.clearCount=0)):2==e.OVER_CONF[main_round]&&(i.lockVec[c][a]&&(i.clearCount--,i.lockVec[c][a]=0,i.lockMap[c][a].visible=!1),i.clearCount<0&&(i.clearCount=0)),i.animalContainer.removeChild(o),i.gameScore++,i.uiView.score.text=""+i.gameScore,i.uiView.stepCount.text=""+i.stepCount,(1==e.OVER_CONF[main_round]||2==e.OVER_CONF[main_round])&&(i.uiView.colorCount.text="剩"+i.clearCount),0==t){console.log("loop");var l=i;3==e.DOWN_ROUND[main_round]?setTimeout(function(){l.downLogic.downSkew()},150):setTimeout(function(){l.downLogic.downAnimal()},150)}})}},t.prototype.createAnimal=function(){if(this.touchEnabled=!1,this.touchChildren=!0,0==e.DOWN_ROUND[main_round])for(var o=0;10>o;o++){var t=12-this.colorVec[o].length;if(0!=t)for(var i=function(t){var i=a.colorVec[o].length;if(1==e.Block_Conf[main_round][o][i]){var c=new e.BlockView(i,o,0),l=11+t;a.animalContainer.addChild(c),a.clearLength--;var r=setInterval(function(){l>=i?(11>=l&&(c.visible=!0),c.y=825-50*l,l--):clearInterval(r)},200),n=Math.ceil(6*Math.random());a.colorVec[o][i]=n,c.Value=n,a.blockMap[o].push(c)}},a=this,c=0;t>c;c++)i(c)}else if(1==e.DOWN_ROUND[main_round])for(var o=0;10>o;o++){for(var l=0,r=0;12>r;r++)-1==this.colorVec[o][r]&&l++;for(var n=function(t){if(-1==s.colorVec[o][t]&&l>0){l--;var i=new e.BlockView(t,o,0),a=11+l;s.animalContainer.addChild(i),s.clearLength--,s.colorVec[o][t]=Math.ceil(6*Math.random()),s.blockMap[o][t]=i,i.Value=s.colorVec[o][t];var c=setInterval(function(){a>=t?(11>=a&&(i.visible=!0),i.y=825-50*a,a--):clearInterval(c)},200)}},s=this,r=11;r>0;r--)n(r)}else if(2==e.DOWN_ROUND[main_round])for(var o=0;10>o;o++)for(var r=0;12>r;r++)if(-1==this.colorVec[o][r]){var h=new e.BlockView(r,o,1);this.animalContainer.addChild(h),this.clearLength--,h.scaleX=0,h.scaleY=0;var g=Math.ceil(6*Math.random());this.colorVec[o][r]=g,h.Value=g,this.blockMap[o][r]=h,egret.Tween.get(h).to({scaleX:1,scaleY:1},200)}},t.prototype.createAnimalEntry=function(){console.log("2->方块生成");for(var o=e.DOWN_CONF[main_round].beginIndex,t=e.DOWN_CONF[main_round].endIndex,i=0,a=o;t>=a;a++)if(-1==this.colorVec[a][11]){i++,console.log("new");var c=new e.BlockView(11,a,1);this.animalContainer.addChild(c),this.blockMap[a][11]=c;var l=Math.ceil(6*Math.random());this.colorVec[a][11]=l,this.blockMap[a][11].Value=l,this.clearLength--}if(this.clearLength){console.log("this.clearLength",this.clearLength);var r=this;r.downLogic.createAnimalPlus()}else{var n=this;setTimeout(function(){var o;if(o=n.gameLogic.globalClear(),n.clearLength=o.length,o.length)n.gameLogic.clearAll(o);else{var t=e.deepCopy(n.colorVec);n.saveColorVec.push(t);var i=e.deepCopy(n.lockVec);n.saveLockVec.push(i),n.saveGameScore.push(n.gameScore),n.saveStepCount.push(n.stepCount),n.saveClearCount.push(n.clearCount),n.gameLogic.DeafCheck(t),n.touchEnabled=!0,n.touchChildren=!0,n.gameLogic.bOver()}},120)}},t.prototype.turnBack=function(){if(this.saveColorVec.length>1&&this.backCount<5){this.backCount++;var o=this.saveColorVec.length,t=this.saveLockVec.length,i=this.saveColorVec[o-2],a=this.saveLockVec[t-2];this.gameScore=this.saveGameScore[this.saveGameScore.length-2],this.clearCount=this.saveClearCount[this.saveGameScore.length-2],this.stepCount=this.saveStepCount[this.saveStepCount.length-2],this.saveLockVec.splice(t-2,1),this.saveColorVec.splice(o-2,1),this.saveGameScore.splice(this.saveGameScore.length-2,1),e.OVER_CONF[main_round]>0&&this.saveClearCount.splice(this.saveClearCount.length-2,1),this.saveStepCount.splice(this.saveStepCount.length-2,1),e.OVER_CONF[main_round]>0&&(this.uiView.colorCount.text="剩"+this.clearCount),this.uiView.score.text=""+this.gameScore,this.uiView.stepCount.text=""+this.stepCount;for(var c=0;10>c;c++)for(var l=0;12>l;l++)i[c][l]>0&&(this.blockMap[c][l].Value=i[c][l]),a[c][l]&&(this.lockMap[c][l].visible=!0);this.lockVec=a,this.colorVec=i}else alert("不能后退了")},t}(egret.DisplayObjectContainer);e.GameStartView=o,__reflect(o.prototype,"happyClear.GameStartView",["happyClear.IGameStartView"])}(happyClear||(happyClear={}));var happyClear;!function(e){e.OVER_CONF={1:0,2:0,3:1,4:1,5:1,6:2,7:2},e.STEP_SCORE={1:[20,90],2:[20,100],3:[30,105],4:[25,110],5:[25,100],6:[25,105],7:[27,105]},e.COLOR_NUM={1:18,2:20,3:22,4:22,5:24,6:25,7:22},e.LOCK_CONF={1:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],2:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,1,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],3:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],4:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,1,0,0],[0,1,1,0,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],5:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],6:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],7:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,1,0,0,0,0],[0,0,1,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,0,1,0,0,0],[0,1,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]]}}(happyClear||(happyClear={}));var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,o,t,i){function a(e){o.call(i,e)}function c(o){o.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,c,null),t.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,c,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var happyClear;!function(e){e.Block_Conf={1:[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1]],2:[[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2]],3:[[1,1,1,0,1,1,1,1,1,-2,-2,-2],[1,1,1,0,1,1,1,1,0,1,-2,-2],[1,1,1,0,1,1,1,1,1,1,1,-2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,0,1,1,1,1,1,1,1,-2],[1,1,1,0,1,1,1,1,0,1,-2,-2],[1,1,1,0,1,1,1,1,1,-2,-2,-2]],4:[[-2,1,1,0,1,1,1,1,1,-2,-2,-2],[1,1,1,1,1,1,1,1,0,1,-2,-2],[1,1,1,0,1,1,1,0,1,1,1,-2],[1,1,1,0,1,1,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,0,1,1,1,1,1,1,1,2],[1,1,1,0,1,1,1,0,1,1,1,-2],[1,1,1,1,1,1,1,1,0,1,-2,-2],[-2,1,1,0,1,1,1,1,1,-2,-2,-2]],5:[[-2,1,1,1,0,1,1,1,1,-2,-2,2],[-2,1,1,1,0,1,1,1,0,1,1,-2],[1,1,1,1,1,1,1,0,1,1,1,-2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,-2],[-2,1,1,1,0,1,1,1,0,1,1,-2],[-2,1,1,1,0,1,1,1,1,-2,-2,2]],6:[[1,1,1,0,1,1,1,1,1,0,1,2],[1,1,1,0,1,1,1,1,1,1,0,2],[1,1,1,0,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,1,1,1,0,1,1,1,1,2],[1,1,1,1,1,1,0,1,1,1,1,2],[1,1,1,1,1,1,1,0,1,1,1,2],[1,1,1,0,1,1,1,1,1,1,1,0],[1,1,1,0,1,1,1,1,1,1,0,2],[1,1,1,0,1,1,1,1,1,0,1,2]],7:[[1,1,1,1,1,0,1,1,1,1,1,0],[1,1,1,1,1,0,1,1,1,1,0,2],[1,1,1,1,1,0,1,1,1,0,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,0,1,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,1,1,2],[1,1,1,1,1,0,1,1,1,0,1,2],[1,1,1,1,1,0,1,1,1,1,0,2],[1,1,1,1,1,0,1,1,1,1,1,0]]},e.DOWN_ROUND={1:0,2:1,3:2,4:3,5:3,6:3,7:3},e.DOWN_CONF={1:{beginIndex:0,endIndex:9},2:{beginIndex:0,endIndex:9},3:{beginIndex:3,endIndex:6},4:{beginIndex:3,endIndex:6},5:{beginIndex:0,endIndex:9},6:{beginIndex:0,endIndex:9},7:{beginIndex:0,endIndex:9}};var o=function(o){function t(e){var t=o.call(this)||this;return t._gameStartView=e,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.init,t),t}return __extends(t,o),t.prototype.init=function(){this._blockValue=this.getValue(),this.colorVec=this._blockValue,this.colorVec=this.flashValue(this.colorVec),this._gameStartView.onStart(this.colorVec)},t.prototype.getValue=function(){for(var o=[],t=0;10>t;t++){o[t]=[];for(var i=0;12>i;i++)if(e.Block_Conf[main_round][t][i]>0){var a=Math.ceil(6*Math.random());o[t].push(a)}else 0==e.Block_Conf[main_round][t][i]?o[t].push(0):o[t].push(null)}return o},t.prototype.flashValue=function(e){for(var o=0,t=0;10>t;t++)for(var i=0;12>i;i++)if(this.colorVec[t][i]){var a=this.canClear(e,i,t);if(a){o++;var c=Math.ceil(6*Math.random());c!=this.colorVec[t][i]&&(e[t][i]=c)}}return 0!=o&&this.flashValue(e),e},t.prototype.canClear=function(e,o,t){for(var i=1,a=t+1;10>a&&e[a][o]==e[t][o];a++)i++;for(var a=t-1;a>=0&&e[a][o]==e[t][o];a--)i++;for(var c=1,l=o+1;12>l&&e[t][l]==e[t][o];l++)c++;for(var l=o-1;l>=0&&e[t][l]==e[t][o];l--)c++;return i>=3||c>=3?i>=3&&c>=3?3:i>=3?1:c>=3?2:void 0:0},t}(egret.DisplayObjectContainer);e.GameData=o,__reflect(o.prototype,"happyClear.GameData",["happyClear.IGameData"])}(happyClear||(happyClear={}));var LoadingUI=function(e){function o(){var o=e.call(this)||this;return o.createView(),o}return __extends(o,e),o.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},o.prototype.setProgress=function(e,o){this.textField.text="Loading..."+e+"/"+o},o}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,o,t){function i(i){o.call(t,i,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?i(a):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var happyClear;!function(e){var o=function(o){function t(e){var t=o.call(this)||this;return t._gameView=e,t}return __extends(t,o),t.prototype.downAnimal=function(){this.touchEnabled=!1,this.touchChildren=!0;var o=0;if(0==e.DOWN_ROUND[main_round])for(var t=0;10>t;t++)for(var i=this._gameView.colorVec[t].length,a=0;i>a;a++){var c=this._gameView.blockMap[t].indexOf(this._gameView.blockMap[t][a]);if(c!=this._gameView.blockMap[t][a].row){var l=this._gameView.blockMap[t][a].row-c;l>=o&&(o=l),this._gameView.blockMap[t][a].row=c,this._gameView.blockMap[t][a].order=10*this._gameView.blockMap[t][a].column+this._gameView.blockMap[t][a].row,this._gameView.blockMap[t][a].y=825-50*c}}else if(1==e.DOWN_ROUND[main_round]){for(var r=0;10>r;r++)for(var n=1;12>n;n++)if(this._gameView.colorVec[r][n]>0&&(-1==this._gameView.colorVec[r][n-1]||0==this._gameView.colorVec[r][n-1])){for(var s=0,h=n-1;h>=0;h--)if(-1==this._gameView.colorVec[r][h])s++;else{if(0!=this._gameView.colorVec[r][h]||-1!=this._gameView.colorVec[r][h-1])break;h--,s+=2}s&&(this._gameView.blockMap[r][n].row=n-s,this._gameView.blockMap[r][n].y=825-50*(n-s),this._gameView.colorVec[r][n-s]=this._gameView.colorVec[r][n],this._gameView.blockMap[r][n-s]=this._gameView.blockMap[r][n],this._gameView.colorVec[r][n]=-1,this._gameView.blockMap[r][n]=null),s>o&&(o=s)}}else if(2==e.DOWN_ROUND[main_round])for(var t=0;10>t;t++)for(var a=1;12>a;a++)if(this._gameView.colorVec[t][a]>0&&-1==this._gameView.colorVec[t][a-1]){for(var s=0,h=a-1;h>=0&&-1==this._gameView.colorVec[t][h];h--)s++;this._gameView.blockMap[t][a].row=a-s,this._gameView.blockMap[t][a].y=825-50*(a-s),this._gameView.colorVec[t][a-s]=this._gameView.colorVec[t][a],this._gameView.blockMap[t][a-s]=this._gameView.blockMap[t][a],this._gameView.colorVec[t][a]=-1,this._gameView.blockMap[t][a]=null}var g;g=250*(o+1),console.log("2"),1==main_round&&(g=250*(o+1));var u=this;setTimeout(function(){u._gameView.createAnimal()},20),setTimeout(function(){var o;if(o=u._gameView.gameLogic.globalClear(),u._gameView.clearLength=o.length,o.length)u._gameView.gameLogic.clearAll(o);else{var t=e.deepCopy(u._gameView.colorVec);u._gameView.saveColorVec.push(t);var i=e.deepCopy(u._gameView.lockVec);u._gameView.saveLockVec.push(i),u._gameView.gameLogic.DeafCheck(t),u._gameView.saveGameScore.push(u._gameView.gameScore),u._gameView.saveStepCount.push(u._gameView.stepCount),u._gameView.saveClearCount.push(u._gameView.clearCount),console.log(u._gameView.colorVec),u.touchEnabled=!0,u.touchChildren=!0,u._gameView.gameLogic.bOver()}},g)},t.prototype.downSkew=function(){console.log("4");for(var e=0;10>e;e++)for(var o=1;12>o;o++)if(this._gameView.colorVec[e][o]>0&&-1==this._gameView.colorVec[e][o-1]){for(var t=0,i=o-1;i>=0&&-1==this._gameView.colorVec[e][i];i--)t++;this._gameView.blockMap[e][o].row=o-t,this._gameView.blockMap[e][o].downStatus=0,this._gameView.blockMap[e][o].y=825-50*(o-t),this._gameView.colorVec[e][o-t]=this._gameView.colorVec[e][o],this._gameView.blockMap[e][o-t]=this._gameView.blockMap[e][o],this._gameView.colorVec[e][o]=-1,this._gameView.blockMap[e][o]=null}this.createAnimalPlus()},t.prototype.createAnimalPlus=function(){var e=this;this._gameView.touchEnabled=!1,this._gameView.touchChildren=!1;var o=0;if(this._gameView.clearLength){console.log("1->方块斜滑");for(var t=function(t){for(var a=function(a){i._gameView.colorVec[t][a]>0&&i._gameView.blockMap[t][a]&&(-1==i._gameView.colorVec[t][a-1]?(i._gameView.colorVec[t][a-1]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].row=a-1,i._gameView.blockMap[t][a].column=t,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*i._gameView.blockMap[t][a].column,y:825-50*i._gameView.blockMap[t][a].row},80).call(function(){console.log("原"+a+"行"+t+"列方块"),e._gameView.blockMap[t][a-1]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功 下滑")}),o++):i._gameView.blockMap[t][a].downStatus?t>0&&9>t&&(1==i._gameView.blockMap[t][a].downStatus&&-1==i._gameView.colorVec[t-1][a]?(i._gameView.colorVec[t-1][a]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].column=t-1,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*(t-1)},80).call(function(){console.log("原"+a+"行"+t+"列方块"),console.log(e._gameView.blockMap[t][a]),e._gameView.blockMap[t-1][a]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功 左滑")}),o++):2==i._gameView.blockMap[t][a].downStatus&&-1==i._gameView.colorVec[t+1][a]?(i._gameView.colorVec[t+1][a]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].column=t+1,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*(t+1)},80).call(function(){console.log("原"+a+"行"+t+"列方块"),console.log(e._gameView.blockMap[t][a]),e._gameView.blockMap[t+1][a]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功 右滑")}),o++):i._gameView.blockMap[t][a].downStatus=0):t>0&&9>t?0!=i._gameView.colorVec[t-1][a]&&null!=i._gameView.colorVec[t-1][a]||-1!=i._gameView.colorVec[t-1][a-1]?0!=i._gameView.colorVec[t+1][a]&&null!=i._gameView.colorVec[t+1][a]||-1!=i._gameView.colorVec[t+1][a-1]||(i._gameView.colorVec[t+1][a-1]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].row=a-1,i._gameView.blockMap[t][a].column=t+1,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*i._gameView.blockMap[t][a].column,y:825-50*i._gameView.blockMap[t][a].row},80).call(function(){console.log("原"+a+"行"+t+"列方块"),e._gameView.blockMap[t][a].downStatus=2,e._gameView.blockMap[t+1][a-1]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功+状态右滑")}),o++):(i._gameView.colorVec[t-1][a-1]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].row=a-1,i._gameView.blockMap[t][a].column=t-1,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*i._gameView.blockMap[t][a].column,y:825-50*i._gameView.blockMap[t][a].row},80).call(function(){console.log("原"+a+"行"+t+"列方块"),e._gameView.blockMap[t][a].downStatus=1,e._gameView.blockMap[t-1][a-1]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功，+ 状态左滑")}),o++):0==t?0!=i._gameView.colorVec[t+1][a]&&null!=i._gameView.colorVec[t+1][a]||-1!=i._gameView.colorVec[t+1][a-1]||(i._gameView.colorVec[t+1][a-1]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].row=a-1,i._gameView.blockMap[t][a].column=t+1,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*i._gameView.blockMap[t][a].column,y:825-50*i._gameView.blockMap[t][a].row},80).call(function(){console.log("原"+a+"行"+t+"列方块"),e._gameView.blockMap[t][a].downStatus=2,e._gameView.blockMap[t+1][a-1]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功")}),o++):0!=i._gameView.colorVec[t-1][a]&&null!=i._gameView.colorVec[t-1][a]||-1!=i._gameView.colorVec[t-1][a-1]||(i._gameView.colorVec[t-1][a-1]=i._gameView.colorVec[t][a],i._gameView.blockMap[t][a].row=a-1,i._gameView.blockMap[t][a].column=t-1,egret.Tween.get(i._gameView.blockMap[t][a]).to({x:145+50*i._gameView.blockMap[t][a].column,y:825-50*i._gameView.blockMap[t][a].row},80).call(function(){console.log("原"+a+"行"+t+"列方块"),e._gameView.blockMap[t][a].downStatus=1,e._gameView.blockMap[t-1][a-1]=e._gameView.blockMap[t][a],e._gameView.blockMap[t][a]=null,e._gameView.colorVec[t][a]=-1,console.log("数组赋值成功,方块左滑")}),o++))},c=1;12>c;c++)a(c)},i=this,a=0;10>a;a++)t(a)}if(this._gameView.clearLength&&0==o){for(var c=function(t){for(var i=function(i){l._gameView.colorVec[t][i]&&l._gameView.blockMap[t][i]&&(0!=l._gameView.colorVec[t][i+1]&&null!=l._gameView.colorVec[t][i+1]||0!=l._gameView.colorVec[t-1][i+1]&&null!=l._gameView.colorVec[t-1][i+1]||(-1==l._gameView.colorVec[t-1][i-1]?(l._gameView.colorVec[t-1][i-1]=l._gameView.colorVec[t][i],l._gameView.blockMap[t][i].row=i-1,l._gameView.blockMap[t][i].column=t-1,egret.Tween.get(l._gameView.blockMap[t][i]).to({x:145+50*l._gameView.blockMap[t][i].column,y:825-50*l._gameView.blockMap[t][i].row},80).call(function(){console.log("原"+i+"行"+t+"列方块"),e._gameView.blockMap[t][i].downStatus=1,e._gameView.blockMap[t-1][i-1]=e._gameView.blockMap[t][i],e._gameView.blockMap[t][i]=null,e._gameView.colorVec[t][i]=-1,console.log("数组赋值成功，左下滑")}),o++):-1==l._gameView.colorVec[t-1][i]&&(l._gameView.colorVec[t-1][i]=l._gameView.colorVec[t][i],l._gameView.blockMap[t][i].column=t-1,egret.Tween.get(l._gameView.blockMap[t][i]).to({x:145+50*(t-1)},80).call(function(){console.log("原"+i+"行"+t+"列方块"),e._gameView.blockMap[t][i].downStatus=1,e._gameView.blockMap[t-1][i]=e._gameView.blockMap[t][i],e._gameView.blockMap[t][i]=null,e._gameView.colorVec[t][i]=-1,console.log("数组赋值成功，左滑")}),o++)))},a=1;11>a;a++)i(a)},l=this,a=1;7>a;a++)c(a);for(var r=function(t){for(var i=function(i){n._gameView.colorVec[t][i]&&n._gameView.blockMap[t][i]&&(0!=n._gameView.colorVec[t][i+1]&&null!=n._gameView.colorVec[t][i+1]||0!=n._gameView.colorVec[t+1][i+1]&&null!=n._gameView.colorVec[t+1][i+1]||(-1==n._gameView.colorVec[t+1][i-1]?(n._gameView.colorVec[t+1][i-1]=n._gameView.colorVec[t][i],n._gameView.blockMap[t][i].row=i-1,n._gameView.blockMap[t][i].column=t+1,egret.Tween.get(n._gameView.blockMap[t][i]).to({x:145+50*n._gameView.blockMap[t][i].column,y:825-50*n._gameView.blockMap[t][i].row},80).call(function(){console.log("原"+i+"行"+t+"列方块"),e._gameView.blockMap[t][i].downStatus=2,e._gameView.blockMap[t+1][i-1]=e._gameView.blockMap[t][i],e._gameView.blockMap[t][i]=null,e._gameView.colorVec[t][i]=-1,console.log("数组赋值成功，右下滑")}),o++):-1==n._gameView.colorVec[t+1][i]&&(n._gameView.colorVec[t+1][i]=n._gameView.colorVec[t][i],n._gameView.blockMap[t][i].column=t+1,egret.Tween.get(n._gameView.blockMap[t][i]).to({x:145+50*(t+1)},80).call(function(){console.log("原"+i+"行"+t+"列方块"),e._gameView.blockMap[t][i].downStatus=2,e._gameView.blockMap[t+1][i]=e._gameView.blockMap[t][i],e._gameView.blockMap[t][i]=null,e._gameView.colorVec[t][i]=-1,console.log("数组赋值成功，右滑")}),o++)))},a=1;11>a;a++)i(a)},n=this,a=3;9>a;a++)r(a)}if(this._gameView.clearLength){var s=this;setTimeout(function(){console.log(o+"->num"),s._gameView.createAnimalEntry()},90)}},t}(egret.DisplayObjectContainer);e.DownLogic=o,__reflect(o.prototype,"happyClear.DownLogic")}(happyClear||(happyClear={}));var happyClear;!function(e){var o=function(e){function o(){var o=e.call(this)||this;return o.addEventListener(egret.Event.ADDED_TO_STAGE,o.drawTable,o),o}return __extends(o,e),o.prototype.drawTable=function(){var e=new egret.Shape;e.graphics.lineStyle(1,2003199),e.graphics.moveTo(120,250),e.graphics.lineTo(620,250),e.graphics.lineTo(620,850),e.graphics.lineTo(120,850),e.graphics.lineTo(120,250),e.graphics.endFill(),this.addChild(e)},o}(egret.DisplayObjectContainer);
e.DrawTable=o,__reflect(o.prototype,"happyClear.DrawTable")}(happyClear||(happyClear={}));var happyClear;!function(e){function o(o){return o instanceof e.BlockView?o:null}function t(e){if("object"!=typeof e)return e;var o={};for(var i in e)o[i]=t(e[i]);return o}function i(e){var o={};for(var t in e)o[t]=e[t];return o}function a(e){for(var o=0;10>o;o++)for(var t=0;12>t;t++){if(8>o&&e[o][t]==e[o+1][t]&&e[o][t]==e[o+2][t])return!1;if(10>t&&e[o][t]==e[o][t+1]&&e[o][t+1]==e[o][t+2])return!1}return!0}e.bBlock=o,e.deepCopy=t,e.copy=i,e.checkClear=a;var c=function(o){function t(e){var t=o.call(this)||this;return t._gameView=e,t}return __extends(t,o),t.prototype.DeafCheck=function(e){var o;e:for(var t=0;9>t;t++){for(var i=0;11>i;i++){var c=e[t][i];e[t][i]=e[t][i+1],e[t][i+1]=c;var l=a(e);if(!l){e[t][i+1]=e[t][i],e[t][i]=c,o=!1;break e}e[t][i+1]=e[t][i],e[t][i]=c,e[t][i]=e[t+1][i],e[t+1][i]=c;var r=a(e);if(!r){e[t+1][i]=e[t][i],e[t][i]=c,o=!1;break e}e[t+1][i]=e[t][i],e[t][i]=c}o=!0}o&&alert("当前没有可以消的，游戏结束")},t.prototype.canClear=function(e,o){for(var t=1,i=o+1;10>i&&(this._gameView.colorVec[i][e]==this._gameView.colorVec[o][e]&&0!=this._gameView.colorVec[i][e]&&null!=this._gameView.colorVec[i][e]);i++)t++;for(var i=o-1;i>=0&&(this._gameView.colorVec[i][e]==this._gameView.colorVec[o][e]&&0!=this._gameView.colorVec[i][e]&&null!=this._gameView.colorVec[i][e]);i--)t++;for(var a=1,c=e+1;12>c&&(this._gameView.colorVec[o][c]==this._gameView.colorVec[o][e]&&0!=this._gameView.colorVec[o][c]&&null!=this._gameView.colorVec[o][c]);c++)a++;for(var c=e-1;c>=0&&(this._gameView.colorVec[o][c]==this._gameView.colorVec[o][e]&&0!=this._gameView.colorVec[o][c]&&null!=this._gameView.colorVec[o][c]);c--)a++;return t>=3||a>=3?t>=3&&a>=3?3:t>=3?1:a>=3?2:void 0:0},t.prototype.getClearList=function(o,t,i){switch(o){case 1:for(var a=[],c=i-1;c>=0&&this._gameView.colorVec[i][t]==this._gameView.colorVec[c][t];c--)a.unshift(this._gameView.blockMap[c][t]);a.push(this._gameView.blockMap[i][t]);for(var c=i+1;10>c&&this._gameView.colorVec[i][t]==this._gameView.colorVec[c][t];c++)a.push(this._gameView.blockMap[c][t]);return a;case 2:for(var l=[],r=t-1;r>=0&&this._gameView.colorVec[i][r]==this._gameView.colorVec[i][t];r--)l.unshift(this._gameView.blockMap[i][r]);l.push(this._gameView.blockMap[i][t]);for(var r=t+1;12>=r&&this._gameView.colorVec[i][r]==this._gameView.colorVec[i][t];r++)l.push(this._gameView.blockMap[i][r]);return l;case 3:for(var n=[],c=i-1;c>=0&&this._gameView.colorVec[i][t]==this._gameView.colorVec[c][t];c--)n.unshift(this._gameView.blockMap[c][t]);n.push(this._gameView.blockMap[i][t]);for(var c=i+1;10>c&&this._gameView.colorVec[i][t]==this._gameView.colorVec[c][t];c++)n.push(this._gameView.blockMap[c][t]);for(var s=[],r=t-1;r>=0&&this._gameView.colorVec[i][r]==this._gameView.colorVec[i][t];r--)s.unshift(this._gameView.blockMap[i][r]);for(var r=t+1;12>=r&&this._gameView.colorVec[i][r]==this._gameView.colorVec[i][t];r++)s.push(this._gameView.blockMap[i][r]);var h=n.concat(s);return 0==e.DOWN_ROUND[main_round]&&h.sort(function(e,o){return e.order-o.order}),h;case 0:return[]}},t.prototype.globalClear=function(){for(var o=[],t=0;10>t;t++)for(var i=0;12>i;i++){var a=this.canClear(i,t),c=[];c=this.getClearList(a,i,t);for(var l=0;l<c.length;l++)-1==o.indexOf(c[l])&&c[l]instanceof e.BlockView&&o.push(c[l])}return 0==e.DOWN_ROUND[main_round]&&o.sort(function(e,o){return e.order-o.order}),this._gameView.firstFlag=!1,o},t.prototype.clearAll=function(e){for(var o=e.length-1;o>=0;o--)this._gameView.clearAnimation(e[o],o)},t.prototype.gameOver=function(){for(var o=0;10>o;o++)for(var t=0;12>t;t++)this._gameView.blockMap[o][t]instanceof e.BlockView&&this._gameView.animalContainer.removeChild(this._gameView.blockMap[o][t]),this._gameView.lockMap[o][t]&&this._gameView.lockContainer.removeChild(this._gameView.lockMap[o][t]);this._gameView.blockMap=[],this._gameView.colorVec=[],this._gameView.lockMap=[],this._gameView.saveColorVec=[],this._gameView.saveLockVec=[],this._gameView.saveStepCount=[],this._gameView.saveGameScore=[],this._gameView.saveClearCount=[],this._gameView.backCount=0,this._gameView.gameScore=0,this._gameView.clearLength=0,this._gameView.clearCount=0,this._gameView.uiView.colorCount.text="",1==e.OVER_CONF[main_round]&&(this._gameView.uiView.target_score.visible=!0),this._gameView.animalInfo&&(this._gameView.animalContainer.removeChild(this._gameView.animalInfo),this._gameView.animalInfo=null),this._gameView.gameData.init()},t.prototype.bOver=function(){1==e.OVER_CONF[main_round]||2==e.OVER_CONF[main_round]?this._gameView.stepCount<=0&&this._gameView.clearCount>0?(alert("游戏结束"),this.gameOver()):this._gameView.stepCount>=0&&this._gameView.clearCount<=0&&(alert("恭喜过关"),main_round>=7?main_round=1:main_round++,this.gameOver()):0==e.OVER_CONF[main_round]&&(console.log("目前分数",this._gameView.gameScore,"通关分数",e.STEP_SCORE[main_round][1]),this._gameView.stepCount<=0&&this._gameView.gameScore<e.STEP_SCORE[main_round][1]?(alert("游戏结束"),this.gameOver()):this._gameView.stepCount>=0&&this._gameView.gameScore>=e.STEP_SCORE[main_round][1]&&(alert("恭喜通关"),main_round>=7?main_round=1:main_round++,this.gameOver()))},t}(egret.DisplayObjectContainer);e.GameLogic=c,__reflect(c.prototype,"happyClear.GameLogic",["happyClear.IGameLogic"])}(happyClear||(happyClear={}));var BlockView=happyClear.BlockView,GameStartView=happyClear.GameStartView,main_round=1,Main=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.isThemeLoadEnd=!1,o.isResourceLoadEnd=!1,o}return __extends(o,e),o.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var o=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",o),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},o.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var o=new eui.Theme("resource/default.thm.json",this.stage);o.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},o.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},o.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},o.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},o.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},o.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},o.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},o.prototype.startCreateScene=function(){var e=new GameStartView;this.addChild(e)},o.prototype.createBitmapByName=function(e){var o=new egret.Bitmap,t=RES.getRes(e);return o.texture=t,o},o.prototype.startAnimation=function(e){var o=this,t=new egret.HtmlTextParser,i=e.map(function(e){return t.parse(e)}),a=this.textfield,c=-1,l=function(){c++,c>=i.length&&(c=0);var e=i[c];a.textFlow=e;var t=egret.Tween.get(a);t.to({alpha:1},200),t.wait(2e3),t.to({alpha:0},200),t.call(l,o)};l()},o}(eui.UILayer);__reflect(Main.prototype,"Main");var happyClear;!function(e){var o=function(o){function t(e){var t=o.call(this)||this;return t._gameStartView=e,t.skinName="HC_TableViewSkin",t.front_round.touchEnabled=!0,t.next_round.touchEnabled=!0,t.refresh_btn.touchEnabled=!0,t.hammer_btn.touchEnabled=!0,t.addStepCount_btn.touchEnabled=!0,t.magicWand_btn.touchEnabled=!0,t.back_btn.touchEnabled=!0,t.front_round.addEventListener(egret.TouchEvent.TOUCH_TAP,t.turnFront,t),t.next_round.addEventListener(egret.TouchEvent.TOUCH_TAP,t.turnNext,t),t.refresh_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onRefresh,t),t.addStepCount_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onAddStepCount,t),t.hammer_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClickHammer,t),t.magicWand_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClickMagicWand,t),t.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onBack,t),t}return __extends(t,o),t.prototype.turnFront=function(){1>=main_round?main_round=7:main_round--,this._gameStartView.gameLogic.gameOver()},t.prototype.turnNext=function(){main_round>=7?main_round=1:main_round++,this._gameStartView.gameLogic.gameOver()},t.prototype.onRefresh=function(){for(var o=this._gameStartView.colorVec,t=this._gameStartView.blockMap,i=0;10>i;i++)for(var a=0;12>a;a++)o[i][a]&&(o[i][a]=Math.ceil(6*Math.random()));o=this._gameStartView.gameData.flashValue(o);for(var i=0;10>i;i++)for(var a=0;12>a;a++)o[i][a]&&(t[i][a].Value=o[i][a]);var c,l=this._gameStartView;if(c=l.gameLogic.globalClear(),l.clearLength=c.length,c.length)l.gameLogic.clearAll(c);else{var r=e.deepCopy(l.colorVec),n=e.deepCopy(l.lockVec);l.saveColorVec.push(r),l.saveLockVec.push(n),l.saveGameScore.push(l.gameScore),l.saveStepCount.push(l.stepCount),l.saveClearCount.push(l.clearCount),l.gameLogic.DeafCheck(r),l.touchEnabled=!0,l.touchChildren=!0,l.gameLogic.bOver()}},t.prototype.onAddStepCount=function(){this._gameStartView.stepCount+=5,this.stepCount.text=""+this._gameStartView.stepCount},t.prototype.onClickHammer=function(){this.tip_text.text="请点击要消除的动物",this._gameStartView.alpha=.9,this._gameStartView.touchStatus=0},t.prototype.onClickMagicWand=function(){this.tip_text.text="请点击要行列消除特效的动物",this._gameStartView.alpha=.8,this._gameStartView.touchStatus=2},t.prototype.onBack=function(){this._gameStartView.turnBack()},t.prototype.partAdded=function(e,t){o.prototype.partAdded.call(this,e,t)},t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},t}(eui.Component);e.UIView=o,__reflect(o.prototype,"happyClear.UIView",["eui.UIComponent","egret.DisplayObject"])}(happyClear||(happyClear={}));